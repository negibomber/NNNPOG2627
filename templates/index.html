<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NNNPOG 2026-27</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>

<header>
    <div style="display:flex; justify-content:space-between; padding: 10px; background: #1e293b; color: white;">
        <strong>ç¬¬ <span id="round_display">{{ current_round }}</span> å·¡</strong>
        <span id="phase_display">èª­ã¿è¾¼ã¿ä¸­...</span>
    </div>
    <div style="padding: 5px 10px; font-size: 0.8rem; background: #334155; color: #cbd5e1;">User: {{ user }}</div>
</header>

<div class="tabs" style="display: flex; border-bottom: 1px solid #ddd; background: white;">
    <button class="tab-btn active" onclick="switchTab('tab-search')" style="flex:1; padding:15px; border:none; background:none; font-weight:bold;">æŒ‡å</button>
    <button class="tab-btn" onclick="switchTab('tab-my')" style="flex:1; padding:15px; border:none; background:none; font-weight:bold;">ãƒã‚¤ãƒªã‚¹ãƒˆ</button>
    <button class="tab-btn" onclick="switchTab('tab-all')" style="flex:1; padding:15px; border:none; background:none; font-weight:bold;">å…¨ä½“</button>
</div>

<div class="container" style="padding: 15px;">
    <div id="reveal_area" style="display:none; background: #fffbeb; border: 2px solid #f59e0b; padding: 15px; border-radius: 10px; margin-bottom: 15px; text-align: center;">
        <div style="font-weight:bold; color:#b45309;">å…¬é–‹ä¸­...</div>
        <div id="reveal_player" style="font-size:1.2rem; margin:10px 0;"></div>
        <div id="reveal_horse" style="font-size:1.5rem; font-weight:bold;"></div>
        <div style="font-size:0.9rem; margin-top:5px;">
            çˆ¶: <span id="reveal_father"></span> / æ¯: <span id="reveal_mother"></span>
        </div>
    </div>

    <div class="content-grid">
        <div id="tab-search" class="tab-content active">
            <div class="card" style="background:white; padding:15px; border-radius:8px; box-shadow:0 2px 4px rgba(0,0,0,0.1);">
                <h3>é¦¬ã‚’æ¢ã™</h3>
                <input type="text" id="s_father" placeholder="çˆ¶å (2æ–‡å­—ä»¥ä¸Š)" style="width:100%; padding:10px; margin-bottom:10px; box-sizing:border-box;">
                <input type="text" id="s_mother" placeholder="æ¯å (2æ–‡å­—ä»¥ä¸Š)" style="width:100%; padding:10px; margin-bottom:10px; box-sizing:border-box;">
                <button onclick="searchHorses()" style="width:100%; padding:12px; background:#2563eb; color:white; border:none; border-radius:5px; font-weight:bold;">æ¤œç´¢</button>
                <div id="search_results" style="margin-top:20px;"></div>
            </div>
        </div>

        <div id="tab-my" class="tab-content" style="display:none;">
            <div class="card" style="background:white; padding:15px; border-radius:8px; box-shadow:0 2px 4px rgba(0,0,0,0.1); margin-bottom:15px;">
                <h3>ã‚¨ãƒ³ãƒˆãƒªãƒ¼ä¸­ã®é¦¬</h3>
                <div id="current_nomination_status" style="font-size:1.2rem; font-weight:bold; color:#2563eb;">
                    {% if current_horse %}{{ current_horse }}{% else %}æœªæŒ‡å{% endif %}
                </div>
                {% if won_horse %}
                <div style="margin-top:10px; color:green; font-weight:bold;">ğŸ‰ å½“é¸ç¢ºå®š: {{ won_horse }}</div>
                {% endif %}
            </div>
            <div class="card" style="background:white; padding:15px; border-radius:8px; box-shadow:0 2px 4px rgba(0,0,0,0.1);">
                <h3>ç²å¾—æ¸ˆã¿ãƒªã‚¹ãƒˆ</h3>
                <div id="my_list">
                    {% for h in confirmed_horses %}
                        {% if h.player_name == user %}
                        <div style="padding:5px 0; border-bottom:1px solid #eee;">ç¬¬{{ h.round }}å·¡: {{ h.horse_name }}</div>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>

        <div id="tab-all" class="tab-content" style="display:none;">
            <div class="card" style="background:white; padding:15px; border-radius:8px; box-shadow:0 2px 4px rgba(0,0,0,0.1);">
                <h3>æŒ‡åçŠ¶æ³ä¸€è¦§</h3>
                <div id="all_status"></div>
            </div>
        </div>
    </div>
</div>

{% if is_mc %}
<div class="mc-panel" style="position:fixed; bottom:0; width:100%; background:#1e293b; color:white; padding:10px; box-sizing:border-box;">
    <div style="font-size:0.7rem; text-align:center; margin-bottom:5px;">MC CONTROL</div>
    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:5px;">
        <button onclick="startReveal()" style="padding:10px; background:#3b82f6; color:white; border:none; border-radius:4px;">å…¬é–‹é–‹å§‹</button>
        <button onclick="nextReveal()" style="padding:10px; background:#f59e0b; color:white; border:none; border-radius:4px;">æ¬¡ã®äººã¸</button>
        <button onclick="runLottery()" style="padding:10px; background:#ef4444; color:white; border:none; border-radius:4px;">æŠ½é¸å®Ÿè¡Œ</button>
        <button onclick="nextRound()" style="padding:10px; background:#10b981; color:white; border:none; border-radius:4px;">æ¬¡ãƒ©ã‚¦ãƒ³ãƒ‰</button>
    </div>
</div>
{% endif %}

<script src="/static/js/app.js"></script>

<script>
    // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆã ã‘ã¯HTMLå´ã«ç°¡æ˜“çš„ã«æ®‹ã™ã‹ã€app.jsã«å«ã‚ã¾ã™
    // ä»Šå›ã¯app.jsã«å«ã¾ã‚Œã¦ã„ã‚‹å‰æã§ã™ãŒã€å¿µã®ãŸã‚ã“ã“ã«ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã§å‹•ä½œã‚’ä¿è¨¼ã—ã¾ã™
    function switchTab(tabId) {
        document.querySelectorAll('.tab-content').forEach(el => el.style.display = 'none');
        document.querySelectorAll('.tab-btn').forEach(el => el.style.borderBottom = 'none');
        
        document.getElementById(tabId).style.display = 'block';
        event.currentTarget.style.borderBottom = '3px solid #2563eb';
    }
</script>

</body>
</html>