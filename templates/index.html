<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NNNPOG 2026-27</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body class="pog-body">

<header>
    <div class="header-top">
        <div class="round-status">
            第 <span id="round_display">{{ current_round }}</span> 巡 
            <span id="phase_label" class="badge-phase">
                {% if phase.strip().lower() == 'nomination' %}指名受付中
                {% elif phase.strip().lower() == 'reveal' %}指名公開中
                {% elif phase.strip().lower() == 'summary' %}重複確認
                {% elif phase.strip().lower() == 'lottery_reveal' %}抽選演出中
                {% elif phase.strip().lower() == 'lottery' %}抽選・結果確定
                {% else %}{{ phase }}{% endif %}
            </span>
        </div>
        <div class="header-actions">
            {% if is_mc %}
            <button onclick="window.downloadCSV()" class="btn btn-success">CSV保存</button>
            {% endif %}
            <a href="/logout" class="btn btn-danger">退出</a>
        </div>
    </div>
    <div class="header-sub">
        <span>User: {{ user }}</span>
        <span id="status_counter">読み込み中...</span>
    </div>
    <div id="waiting_list_bar" class="waiting-bar"></div>
</header>

<div class="tabs">
    <button class="tab-btn active" onclick="switchTab('tab-search')" id="btn-search">馬選択</button>
    <button class="tab-btn" onclick="switchTab('tab-all')" id="btn-all">指名一覧</button>
</div>

<div class="container">
    <div id="reveal_area" class="reveal-card">
        <div class="reveal-label"><span id="reveal_round"></span>位指名</div>
        <div id="reveal_player" class="reveal-player"></div>
        <div id="reveal_horse" class="reveal-horse"></div>
        <div class="reveal-details">
            父: <span id="reveal_father"></span> / 母: <span id="reveal_mother"></span><br>
            厩舎: <span id="reveal_stable"></span> / 生産者: <span id="reveal_breeder"></span>
        </div>
    </div>

    <div id="lottery_summary_area" class="summary-area">
        <h2 class="area-title">指名結果</h2>
        <div id="lottery_summary_list"></div>
    </div>

    <div id="lottery_reveal_area" class="lottery-box">
        <div class="lottery-loading">抽選中...</div>
        <div id="lot_horse_name" class="lot-horse"></div>
        <div id="lot_candidate_list" class="lot-candidates"></div>
        <div id="lot_result_box" class="lot-result-card">
            <div class="win-label">当選</div>
            <div id="lot_winner_name" class="win-player"></div>
            <div class="win-footer">おめでとうございます！<br>他の方は再指名となります。</div>
        </div>
    </div>

    <div id="tab-search" class="tab-content">
        <div class="card">
            <h3 class="card-title">馬を探す</h3>
            <p class="card-subtitle">父名または母名を2文字以上入力してください</p>
            <input type="text" id="s_father" class="input-field" placeholder="父名 (2文字以上)">
            <input type="text" id="s_mother" class="input-field" placeholder="母名 (2文字以上)">
            
            <div id="search_results" class="results-container"></div>
        </div>
    </div>

    <div id="tab-all" class="tab-content" style="display:none;">
        <div id="all_status_list"></div>
    </div>
</div>

{% if is_mc %}
<div id="mc_panel">
    <button id="mc_main_btn" class="mc_main_btn">読み込み中...</button>
</div>
{% endif %}

<script src="/static/js/api.js?v={{ version }}"></script>
<script src="/static/js/ui.js?v={{ version }}"></script>
<script src="/static/js/theater.js?v={{ version }}"></script>
<script src="/static/js/app.js?v={{ version }}"></script>
<script>
    function switchTab(tabId) {
        document.querySelectorAll('.tab-content').forEach(el => { el.classList.add('is-hidden'); el.classList.remove('is-visible'); });
        document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
        
        const target = document.getElementById(tabId);
        target.classList.add('is-visible'); target.classList.remove('is-hidden');
        const activeBtn = document.getElementById('btn-' + tabId.replace('tab-', ''));
        if (activeBtn) activeBtn.classList.add('active');
    }

    document.addEventListener('DOMContentLoaded', () => {
        const savedTab = localStorage.getItem('activeTab');
        if (savedTab && document.getElementById(savedTab)) {
            switchTab(savedTab);
            localStorage.removeItem('activeTab');
        }
    });
</script>
<div id="theater_layer"></div>
</body>
</html>